
{% import "macros/form.njk" as forms %}

{% macro parseField(field, data={}, aryname='', aryidx='') %}
{% set fieldname = field.name %}
{% if aryname|length %}
	{% set fieldname = aryname + "[" + aryidx + "][" + field.name + "]" %}
{% endif %}
{% if field.type == 'string' %}
	{% set placeholder = field|getPlace %}
	{{ forms.textfield(fieldname, value=data[field.name], tip=field.tip, placeholder=placeholder) }}
{% elif field.type == 'text' %}
	{% set placeholder = field|getPlace %}
	{{ forms.textareafield(fieldname, value=data[field.name], tip=field.tip, placeholder=placeholder) }}
{% elif field.type == 'integer' %}
	{% set placeholder = field|getPlace %}
	{{ forms.numberfield(fieldname, value=data[field.name], tip=field.tip, placeholder=placeholder) }}
{% elif field.type == 'image' %}
	{{ forms.imagefilefield(fieldname, value=data[field.name]) }}
{% elif field.type == 'collection' and field.layout == 'tags-selection' %}
	{{ forms.tagsselection(fieldname, tip=field.tip, options=data[field.related], autoCreate=field.autoCreate) }}
{% elif field.type == 'json' %}
	{% if field.layout == 'list' %}
	{{ editlist(fieldname, field.fields, data[field.name]) }}
	{% endif %}
{% endif %}
{% endmacro %}

{% macro parseFormField(field, data={}) %}
<div class="form-group row">
	<label class="col-form-label col-sm-2 text-sm-right">{{ field.label }}</label>
	<div class="col-sm-10">
		{{ parseField(field, data) }}
	</div>
</div>
{% endmacro %}

{% macro tabs(sections, data={}) %}
<div class="nav-tabs-top nav-responsive-sm">
	<ul class="nav nav-tabs">
		{% for sec in sections %}
		<li class="nav-item">
			<a class="nav-link {% if loop.first %}active{% endif %}" data-toggle="tab" href="#{{ sec.id }}">{{ sec.title }}
			<span class="badge badge-danger"></span>
			</a>
		</li>
		{% endfor %}
	</ul>
	<div class="tab-content">
		{% for sec in sections %}
		<div class="tab-pane fade {% if loop.first %}show active{% endif %}" id="{{ sec.id }}">
			<div class="card-body">
			{% set fields = sec.fields %}
			{% for field in fields %}
				{% if loop.length == 1 %}
				{{ parseField(field, data) }}
				{% else %}
				{{ parseFormField(field, data) }}
				{% endif %}
			{% endfor %}
			</div>
		</div>
		{% endfor %}
	</div>
</div>
{% endmacro %}

{% macro editlist(name, fields, datalist=[]) %}
<div class="table-responsive">
	<table class="table" editlist-table editlist-prefix="{{ name }}">
		<thead>
			<tr>
				{% for field in fields %}
				<th {% if field.width|length %}style="width: {{ field.width }}"{% endif %}>{{ field.label }}</th>
				{% endfor %}
				<th></th>
			</tr>
		</thead>
		<tbody>
			{% for data in datalist %}
			{% set didx = loop.index0 %}
			<tr>
				{% for field in fields %}
				<td>
					{{ parseField(field, data, aryname=name, aryidx=didx) }}
				</td>
				{% endfor %}
				<td>
					<a href="javascript:void(0)" class="btn btn-outline-danger md-btn-flat icon-btn btn-sm" editlist-remove-btn><i class="ion ion-md-close"></i></a>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
<template>
	<tr>
		{% for field in fields %}
		<td>
			{{ parseField(field) }}
		</td>
		{% endfor %}
		<td>
			<a href="javascript:void(0)" class="btn btn-outline-danger md-btn-flat icon-btn btn-sm" editlist-remove-btn><i class="ion ion-md-close"></i></a>
		</td>
	</tr>
</template>
<button type="button" class="btn btn-outline-primary" editlist-add-btn><i class="ion ion-md-add"></i></button>
{% endmacro %}
